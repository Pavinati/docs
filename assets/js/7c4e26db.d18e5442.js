"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[79],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),s=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},d=function(e){var t=s(e.components);return n.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=s(a),h=r,m=u["".concat(p,".").concat(h)]||u[h]||c[h]||i;return a?n.createElement(m,l(l({ref:t},d),{},{components:a})):n.createElement(m,l({ref:t},d))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=u;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var s=2;s<i;s++)l[s]=a[s];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},9452:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>o,toc:()=>s});var n=a(7462),r=(a(7294),a(3905));const i={sidebar_position:2},l="Create a third-party Clea Portal App",o={unversionedId:"get_started/create_a_clea_portal_app",id:"get_started/create_a_clea_portal_app",title:"Create a third-party Clea Portal App",description:"The Platform supports loading external web apps that can be developed by third-party actors.",source:"@site/docs/2_get_started/2-create_a_clea_portal_app.md",sourceDirName:"2_get_started",slug:"/get_started/create_a_clea_portal_app",permalink:"/get_started/create_a_clea_portal_app",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Connect a Device",permalink:"/get_started/connect_a_device"},next:{title:"APIs References",permalink:"/get_started/apis_references"}},p={},s=[{value:"Requirements",id:"requirements",level:2},{value:"Availability",id:"availability",level:3},{value:"Bundle format",id:"bundle-format",level:3},{value:"Bundle content",id:"bundle-content",level:3},{value:"App props",id:"app-props",level:4},{value:"Settings",id:"settings",level:4},{value:"Styling the App",id:"styling-the-app",level:2},{value:"Limitations",id:"limitations",level:2},{value:"Example apps",id:"example-apps",level:2},{value:"Registering an app on the Platform",id:"registering-an-app-on-the-platform",level:2}],d={toc:s};function c(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"create-a-third-party-clea-portal-app"},"Create a third-party Clea Portal App"),(0,r.kt)("p",null,"The Platform supports loading external web apps that can be developed by third-party actors."),(0,r.kt)("p",null,"A ",(0,r.kt)("strong",{parentName:"p"},"Clea Portal App")," consists of an external web application encapsulated within Clea Portal as a shadow DOM."),(0,r.kt)("p",null,"The App is viewable in any appliance depending on its compatibility with supported Astarte interfaces. When it comes to authentication and data collection, it requires interaction with Astarte APIs."),(0,r.kt)("h2",{id:"requirements"},"Requirements"),(0,r.kt)("p",null,"To ensure interoperability with the Platform, an app must meet the following criteria:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Availability"),": the app is made available at a public URL as a single JavaScript file bundle;"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Bundle format"),": the app\u2019s bundle must be a JavaScript ES Module;"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Bundle content"),": the default export of the app must be an object to handle the app\u2019s lifecycle. More on this later.")),(0,r.kt)("h3",{id:"availability"},"Availability"),(0,r.kt)("p",null,"The app must be accessible at a public URL and served with appropriate CORS configuration in order to be fetched from the Platform web app."),(0,r.kt)("h3",{id:"bundle-format"},"Bundle format"),(0,r.kt)("p",null,"The app must be a single file bundle that can be parsed as an ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules"},"ES Module"),"."),(0,r.kt)("h3",{id:"bundle-content"},"Bundle content"),(0,r.kt)("p",null,"The app\u2019s bundle must have a default export with the following object structure, using TypeScript signatures:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"{\n  mount: (\n    container: HTMLElement,\n    props: AppProps,\n    settings: Settings\n  ) => void;\n  unmount: (container: HTMLElement) => void;\n}\n")),(0,r.kt)("p",null,"where:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mount")," is a synchronous function that will be called to instantiate the app inside a Platform\u2019s page. ",(0,r.kt)("inlineCode",{parentName:"li"},"container")," is the DOM element within which the app must render itself, while ",(0,r.kt)("inlineCode",{parentName:"li"},"props")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"settings")," are objects supplied by the Platform. Read the dedicated paragraph below for further details about the ",(0,r.kt)("inlineCode",{parentName:"li"},"props")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"settings")," objects."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"unmount")," is a synchronous function that will be called to dispose of the app\u2019s instance, if any cleanup should be done. ",(0,r.kt)("inlineCode",{parentName:"li"},"container")," is the DOM element where the app was instantiated on.")),(0,r.kt)("p",null,"These lifecycle methods are intended to be lightweight and should return quickly. If the app requires a long setup, that should be handled separately."),(0,r.kt)("h4",{id:"app-props"},"App props"),(0,r.kt)("p",null,"Upon mount, the app will be provided with a ",(0,r.kt)("inlineCode",{parentName:"p"},"props")," object that has the following type signature:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"type AppProps = {\n  astarteUrl: URL;\n  realm: string;\n  token: string;\n  deviceId: string;\n}\n")),(0,r.kt)("p",null,"Thus you will have access to the following parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"astarteUrl")," is a URL object pointing to an Astarte instance."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"realm")," refers to the Astarte realm."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"token")," is the authentication token to access Astarte services."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"deviceId")," refers to the Astarte device ID used also as Clea unique identifier.")),(0,r.kt)("p",null,"The Astarte token grants permissions to access Astarte services in order to query for interface data on the device with ID ",(0,r.kt)("inlineCode",{parentName:"p"},"deviceId"),". You can look at Astarte\u2019s documentation to know about ",(0,r.kt)("a",{parentName:"p",href:"https://docs.astarte-platform.org/1.0/050-query_device.html"},"querying a device")," or the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.astarte-platform.org/1.0/001-intro_api.html"},"REST API reference"),"."),(0,r.kt)("h4",{id:"settings"},"Settings"),(0,r.kt)("p",null,"The settings object contains data to have a congruent experience with Clea"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"type Settings = {\n  themeUrl: string;\n  userPreferences: UserPreferences;\n}\n\ntype UserPreferences = {\n  language: string;\n};\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"themeUrl")," contains the URL or a relative path of the css style used by Clea. You can incorporate this in the App using a link tag to have the same look and feel of Clea."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"language")," is the language selected by the user logged in using the ",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/ISO_639-1"},"ISO 639-1")," format. When no language is selected, it defaults to \u201cen\u201d for english.")),(0,r.kt)("h2",{id:"styling-the-app"},"Styling the App"),(0,r.kt)("p",null,"DOM elements can be styled as usual with inline styles or CSS id and classes. Inline styles aside, CSS styles can only be declared with one or multiple ","<","style> or ","<","link> tags in the top level of the App container provided during the mount phase."),(0,r.kt)("p",null,"The App is mounted inside a shadow DOM, so style declared there won\u2019t leak outside and vice versa."),(0,r.kt)("p",null,"Clea uses a customized version of ",(0,r.kt)("a",{parentName:"p",href:"https://getbootstrap.com/docs/5.1/getting-started/introduction/"},"Bootstrap 5.1"),". The stylesheet file used by Clea is provided to external apps via the themeUrl parameter (see also ",(0,r.kt)("a",{parentName:"p",href:"#settings"},"Settings")," section)."),(0,r.kt)("h2",{id:"limitations"},"Limitations"),(0,r.kt)("p",null,"The Platform supports third-party apps thanks to modern technologies such as ES Modules. As such, apps run on browsers that support such features. You can look at the ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules#browser_support"},"compatibility matrixes")," for details about browser support."),(0,r.kt)("p",null,"Since the app is loaded as a module inside a Platform\u2019s web page, JavaScript methods that modify global state of the page must be avoided; these forbidden actions include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Changing the page\u2019s location or history."),(0,r.kt)("li",{parentName:"ul"},"Interacting with the browser\u2019s storages such as ",(0,r.kt)("inlineCode",{parentName:"li"},"localStorage"),"."),(0,r.kt)("li",{parentName:"ul"},"Using global variables or modifying the ",(0,r.kt)("inlineCode",{parentName:"li"},"window")," object.")),(0,r.kt)("h2",{id:"example-apps"},"Example apps"),(0,r.kt)("p",null,"You can look at the sample boilerplate codes (React + Typescript) for app development that are provided in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/clea-platform/clea-examples"},"Clea Examples")," repository."),(0,r.kt)("h2",{id:"registering-an-app-on-the-platform"},"Registering an app on the Platform"),(0,r.kt)("p",null,"The Platform provides a dedicated section to register third-party Clea Portal Apps. Check how to do that in the ",(0,r.kt)("a",{parentName:"p",href:"/clea_portal_walkthrough/admin_console#tenant-applications"},"Tenant Applications")," section on the Admin Console page."))}c.isMDXComponent=!0}}]);